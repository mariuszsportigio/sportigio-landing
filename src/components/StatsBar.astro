---
// StatsBar.astro
import fs from "node:fs";
import path from "node:path";

type Logo = { src: string; alt: string };

const defaultLogos: Logo[] = [
  { src: "/teams/legia.avif", alt: "Legia" },
  { src: "/teams/projekt-warszawa.avif", alt: "Projekt Warszawa" },
  { src: "/teams/radomka.avif", alt: "Radomka" },
  { src: "/teams/trefl.avif", alt: "Trefl" },
];

let logos: Logo[] = defaultLogos;
let durationSeconds = 28;

try {
  const teamsDir = path.resolve(process.cwd(), "public", "teams");
  if (fs.existsSync(teamsDir)) {
    const entries = fs
      .readdirSync(teamsDir)
      .filter((name) => /\.(png|jpe?g|svg|webp|avif)$/i.test(name))
      .sort((a, b) => a.localeCompare(b));

    const discovered = entries.map((file) => {
      const base = file.replace(/\.[^.]+$/, "");
      const alt = base
        .replace(/[-_]+/g, " ")
        .replace(/\b\w/g, (m) => m.toUpperCase());
      return { src: `/teams/${file}`, alt } as Logo;
    });

    if (discovered.length > 0) {
      logos = discovered;
    }
  }
} catch {
  // If filesystem access fails (e.g., during some builds), fallback to defaults
}
// Adjust marquee speed based on number of logos (more logos = longer loop)
durationSeconds = Math.max(16, Math.round(logos.length * 3.5));
---

<section class="py-8 bg-white">
  <div class="max-w-5xl mx-auto px-4">
    <!-- Trust Message -->
    <div class="text-center mb-6">
      <p class="text-base text-gray-600 font-medium">
        Zaufało nam już <span class="text-[#0B2360] font-bold">500+</span> klubów
        sportowych w całej Polsce
      </p>
    </div>

    <!-- Club Logos Marquee -->
    <div class="logo-marquee mb-8 opacity-80">
      <div
        class="marquee-track"
        style={`--marquee-duration: ${durationSeconds}s`}
      >
        {
          logos.map(({ src, alt }) => (
            <img
              src={src}
              alt={alt}
              height="40"
              loading="lazy"
              decoding="async"
            />
          ))
        }
        {
          logos.map(({ src }) => (
            <img
              src={src}
              alt=""
              aria-hidden="true"
              height="40"
              loading="lazy"
              decoding="async"
            />
          ))
        }
      </div>
    </div>

    <!-- Stats Cards -->
    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
      <!-- Stat 1 -->
      <div
        class="bg-white rounded-lg p-4 text-center shadow-sm border border-gray-100"
      >
        <div
          class="w-12 h-12 bg-[#E8EDF7] rounded-lg mx-auto mb-3 flex items-center justify-center"
        >
          <svg
            class="w-6 h-6 text-[#0B2360]"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"
            ></path>
          </svg>
        </div>
        <div class="text-lg font-bold text-gray-900 mb-1">25,000+</div>
        <div class="text-xs text-gray-600">Aktywnych członków</div>
      </div>

      <!-- Stat 2 -->
      <div
        class="bg-white rounded-lg p-4 text-center shadow-sm border border-gray-100"
      >
        <div
          class="w-12 h-12 bg-[#E0FCFE] rounded-lg mx-auto mb-3 flex items-center justify-center"
        >
          <svg
            class="w-6 h-6 text-[#01DFEC]"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
        </div>
        <div class="text-lg font-bold text-gray-900 mb-1">96%</div>
        <div class="text-xs text-gray-600">Zadowolenie</div>
      </div>

      <!-- Stat 3 -->
      <div
        class="bg-white rounded-lg p-4 text-center shadow-sm border border-gray-100"
      >
        <div
          class="w-12 h-12 bg-[#FCE7FE] rounded-lg mx-auto mb-3 flex items-center justify-center"
        >
          <svg
            class="w-6 h-6 text-[#EA36E1]"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M13 10V3L4 14h7v7l9-11h-7z"></path>
          </svg>
        </div>
        <div class="text-lg font-bold text-gray-900 mb-1">48h</div>
        <div class="text-xs text-gray-600">Średni czas wdrożenia</div>
      </div>

      <!-- Stat 4 -->
      <div
        class="bg-white rounded-lg p-4 text-center shadow-sm border border-gray-100"
      >
        <div
          class="w-12 h-12 bg-[#F0F4FB] rounded-lg mx-auto mb-3 flex items-center justify-center"
        >
          <svg
            class="w-6 h-6 text-[#0B2360]"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"
            ></path>
          </svg>
        </div>
        <div class="text-lg font-bold text-gray-900 mb-1">2.5M</div>
        <div class="text-xs text-gray-600">Zaoszczędzone złotówki</div>
      </div>
    </div>

    <!-- Testimonial Quote -->
    <div class="text-center">
      <blockquote class="text-base text-gray-700 italic mb-2">
        "Sportigio całkowicie zmieniło sposób zarządzania naszym klubem.
        Oszczędzamy 10 godzin tygodniowo!"
      </blockquote>
      <cite class="text-sm text-gray-500">
        — Marcin Kowalski, Prezes KS Cracovia
      </cite>
    </div>
  </div>
</section>

<style>
  .logo-marquee {
    position: relative;
    overflow: hidden;
  }

  .logo-marquee::before,
  .logo-marquee::after {
    content: "";
    position: absolute;
    top: 0;
    bottom: 0;
    width: 80px;
    pointer-events: none;
  }

  .logo-marquee::before {
    left: 0;
    background: linear-gradient(
      to right,
      rgba(255, 255, 255, 1),
      rgba(255, 255, 255, 0)
    );
  }

  .logo-marquee::after {
    right: 0;
    background: linear-gradient(
      to left,
      rgba(255, 255, 255, 1),
      rgba(255, 255, 255, 0)
    );
  }

  .marquee-track {
    display: flex;
    align-items: center;
    gap: 2.5rem; /* ~gap-10 */
    width: max-content;
    animation: marquee var(--marquee-duration, 30s) linear infinite;
  }

  .logo-marquee:hover .marquee-track {
    animation-play-state: paused;
  }

  .logo-marquee img {
    height: 2.5rem; /* h-10 */
    width: auto;
    object-fit: contain;
    filter: grayscale(100%);
    opacity: 0.9;
    transition: opacity 150ms ease-in-out;
  }

  .logo-marquee img:hover {
    opacity: 1;
    filter: none;
  }

  @keyframes marquee {
    from {
      transform: translateX(0);
    }
    to {
      transform: translateX(-50%);
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .marquee-track {
      animation: none;
    }
  }
</style>
